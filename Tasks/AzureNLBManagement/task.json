{
	"id": "e94f1750-a6a8-11e6-be69-bdf37a7b15d8",
	"name": "AzureNLBManagement",
	"friendlyName": "Azure Network Load Balancer (Preview)",
	"description": "Connect/Disconnect an Azure virtual machine's network interface to a Load Balancer's backend address pool",
	"author": "Microsoft Corporation",
	"helpMarkDown": "Replace with markdown to show in help",
	"category": "Utility",
	"visibility": [
		"Build",
		"Release", 
        "Preview"
    ],
    "runsOn": [
        "MachineGroup"
    ],
	"version": {
		"Major": "1",
		"Minor": "0",
		"Patch": "0"
	},
	"minimumAgentVersion": "1.95.0",
	"instanceNameFormat": "Azure Network Load Balancer: $(Action) VMs from $(LoadBalancer)",
	"inputs": [
		{
            "name": "ConnectedServiceName",
            "type": "connectedService:AzureRM",
            "label": "AzureRM Subscription",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Select the Azure Resource Manager subscription for the deployment."
		}, 
		{
            "name": "ResourceGroupName",
            "type": "pickList",
            "label": "Resource Group",
            "required": true,
            "helpMarkDown": "Select the resource group name.",
            "properties": {
                "EditableOptions": "True"
            }
        }, 
        {
            "name": "LoadBalancer",
            "type": "pickList",
            "label": "Load Balancer Name",
            "required": true,
            "helpMarkDown": "Select or enter the load balancer.",
            "properties": {
                "EditableOptions": "True"
            }
        }, 
        {
            "name": "Action",
            "type": "pickList",
            "label": "Action",
            "defaultValue": "",
            "required": true,
            "options": {
                "Disconnect": "Disconnect Network Interface",
                "Connect": "Connect Network Interface"
            },
            "helpMarkDown": "Connect: Adds the virtual machine’s network interface to load balancer backend pool. So that it starts receiving network traffic based on the load balancing rules for the load balancer resource.\n\nDisconnect:  Removes the virtual machine’s network interface from the load balancer’s backend pool. So that it stops receiving network traffic."
        },
        {
            "name": "NICDetection",
            "type": "pickList",
            "label": "NIC Detection",
            "required": true,
            "options": {
                "AutoDetectNic": "Auto select primary network interface",
                "CustomNic": "Custom - virtual machine : network interface"
            },
            "defaultValue": "AutoDetectNic",
            "helpMarkDown": "Custom: Specify mapping virtual machine and the network interface associated with the virtual machine to be added/removed from load balancer backend pool. The format to specify is: `<virtual machine1>:<network interface name1> <virtual machine2>:<network interface name2>`… and so on.\n\nAuto select:  Will select the primary network interface of the virtual machine to perform the Action of connecting/disconnecting from load balancer's backend address pool."
        },
        {
            "name": "VmNicMapping",
            "type": "multiLine",
            "label": "VM:NIC Mapping",
            "defaultValue": "",
            "required": false,
            "visibleRule": "NICDetection = CustomNic",
            "helpMarkDown": "Specify mapping virtual machine and the network interface associated with the virtual machine to be added/removed from load balancer backend pool. Specify space delimited pairs for multiple virtual machines. For example, `<virtual machine1>:<network interface name1> <virtual machine2>:<network interface name2>…` and so on."
        }
	],
	"dataSourceBindings": [
        {
            "target": "ResourceGroupName",
            "endpointId": "$(ConnectedServiceName)",
            "dataSourceName": "AzureResourceGroups"
        },
        {
            "target": "LoadBalancer",
            "endpointId": "$(ConnectedServiceName)",
            "dataSourceName": "AzureRMLoadBalancers",
            "parameters": {
                "ResourceGroupName": "$(ResourceGroupName)"
            }
        }
    ],
    "execution": {
		"Node": {
			"target": "nlbtask.js"
		}
	},
    "messages": {
        "CouldNotFetchNicDetails": "Could not fetch NIC configuration details for the Azure Virtual Machine : %s",
        "NicDetailsFetched": "NIC configuration details fetched for the Azure Virtual Machine : %s",
        "GettingAllNetworkInterfacesInTheResourceGroup": "Getting all network interfaces in the Resource Group : %s",
        "RequestingForAuthToken": "Requesting for authorization token : %s",
        "ConnectingVMtoLB": "Connecting the Azure Virtual Machine to the Load Balancer - %s's backend pool.",
        "DisconnectingVMfromLB": "Disconnect the Azure Virtual Machine from the Load Balancer - %s's backend pool.",
        "setNICStatus": "Network interface %s set successfully",
        "MaxRetriesExceededForPut": "Maximum retries exceeded for making the PUT request for the Network Interface : %s",
        "FailedPutResponse": "PUT request for setting the Network Interface %s failed with response %s",
        "GettingPrimaryNicForVm": "Getting the primary nic for the vm %s",
        "ActionCompletedSuccefully": "The Action - %s successfully completed for the VM %s and load balancer %s"
    }
}