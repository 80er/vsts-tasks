{
	"id": "e94f1750-a6a8-11e6-be69-bdf37a7b15d8",
	"name": "AzureNLBManagement",
	"friendlyName": "Azure Network Load Balancer (Preview)",
	"description": "Connect/Disconnect an Azure virtual machine's network interface to a Load Balancer's backend address pool",
	"author": "Microsoft Corporation",
	"helpMarkDown": "Replace with markdown to show in help",
	"category": "Utility",
	"visibility": [
		"Build",
		"Release",
        "Preview"
    ],
    "runsOn": [
        "MachineGroup"
    ],
	"version": {
		"Major": "1",
		"Minor": "0",
		"Patch": "0"
	},
	"minimumAgentVersion": "1.95.0",
	"instanceNameFormat": "Azure Network Load Balancer: $(LoadBalancer) - $(Action)",
	"inputs": [
		{
            "name": "ConnectedServiceName",
            "type": "connectedService:AzureRM",
            "label": "AzureRM Subscription",
            "defaultValue": "",
            "required": true,
            "helpMarkDown": "Select the Azure Resource Manager subscription for the deployment."
		}, 
		{
            "name": "ResourceGroupName",
            "type": "pickList",
            "label": "Resource Group",
            "required": true,
            "helpMarkDown": "Select the resource group name.",
            "properties": {
                "EditableOptions": "True"
            }
        }, 
        {
            "name": "LoadBalancer",
            "type": "pickList",
            "label": "Load Balancer Name",
            "required": true,
            "helpMarkDown": "Select or enter the load balancer.",
            "properties": {
                "EditableOptions": "True"
            }
        }, 
        {
            "name": "Action",
            "type": "pickList",
            "label": "Action",
            "defaultValue": "",
            "required": true,
            "options": {
                "Disconnect": "Disconnect Network Interface",
                "Connect": "Connect Network Interface"
            },
            "helpMarkDown": "Disconnect:  Removes the virtual machine’s network interface from the load balancer’s backend pool. So that it stops receiving network traffic.\n\nConnect: Adds the virtual machine’s network interface to load balancer backend pool. So that it starts receiving network traffic based on the load balancing rules for the load balancer resource."
        },
        {
            "name": "NICDetection",
            "type": "pickList",
            "label": "Network Interface Detection",
            "required": true,
            "options": {
                "AutoDetectNic": "Auto select primary network interface",
                "CustomNic": "Custom"
            },
            "defaultValue": "AutoDetectNic",
            "helpMarkDown": "Auto select:  Will select the primary network interface of the virtual machine to perform the Action of connecting/disconnecting from load balancer's backend address pool.\n\nCustom: Provide a comma separated list of network interfaces which you want to connect or disconnect to the load balancer's backend address pool. Ex: vnic1,vnic2 .. "
        },
        {
            "name": "inputNics",
            "type": "multiLine",
            "label": "Network Interfaces",
            "defaultValue": "",
            "required": false,
            "visibleRule": "NICDetection = CustomNic",
            "helpMarkDown": "Provide a comma separated list of network interfaces which you want to connect or disconnect to the load balancer's backend address pool. Ex: vnic1,vnic2 .. "
        }
	],
	"dataSourceBindings": [
        {
            "target": "ResourceGroupName",
            "endpointId": "$(ConnectedServiceName)",
            "dataSourceName": "AzureResourceGroups"
        },
        {
            "target": "LoadBalancer",
            "endpointId": "$(ConnectedServiceName)",
            "dataSourceName": "AzureRMLoadBalancers",
            "parameters": {
                "ResourceGroupName": "$(ResourceGroupName)"
            }
        }
    ],
    "execution": {
		"Node": {
			"target": "nlbtask.js"
		}
	},
    "messages": {
        "CouldNotFetchNicDetails": "Could not fetch network interface configuration details for the Azure Virtual Machine : %s",
        "NicDetailsFetched": "Network interface configuration details fetched for the Azure Virtual Machine : %s",
        "GettingAllNetworkInterfacesInTheResourceGroup": "Getting all network interfaces in the Resource Group : %s",
        "RequestingForAuthToken": "Requesting for authorization token : %s",
        "ConnectingVMtoLB": "Connecting the Azure Virtual Machine to the Load Balancer - %s's backend pool.",
        "DisconnectingVMfromLB": "Disconnect the Azure Virtual Machine from the Load Balancer - %s's backend pool.",
        "setNICStatus": "Network interface %s set successfully",
        "MaxRetriesExceededForSettingNetworkInterface": "Maximum retries exceeded for setting the Network Interface : %s",
        "FailedSettingNetworkInterface": "Setting the Network Interface %s failed with response %s",
        "GettingPrimaryNicForVm": "Getting the primary network interface for the vm %s",
        "ActionCompletedSuccefully": "The Action - %s completed successfully for the virtual machine %s and load balancer %s",
        "CouldNotFetchAcessToken": "Could not fetch access token.\nStatus Code : %s\nStatus Message : %s\n%s",
        "CouldNotFetchNetworkInterfacesInRg": "Could not fetch Network Interfaces in the resource group %s.\nStatus Code : %s\nStatus Message : %s\n%s",
        "CouldNotFetchLoadBalancer": "Could not fetch Load Balancer %s.\nStatus Code : %s\nStatus Message : %s\n%s",
        "CouldNotFetchNetworkInterface": "Could not fetch Network Interface %s.\nStatus Code : %s\nStatus Message : %s\n%s",
        "SettingTheNetworkInterface": "Setting the network interface %s"
    }
}